<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Travel Routes - Find Nearby Walks</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
    <link rel="stylesheet" href="routes.css">
</head>
<body>
    <header class="app-header">
        <div class="container">
            <nav class="main-nav">
                <a href="index.html" class="logo">TravelCompanion</a>
                <ul class="nav-links">
                    <li><a href="index.html">Currency Converter</a></li>
                    <li><a href="routes.html" class="active">Walking Routes</a></li>
                </ul>
                <div id="auth-container">
                    <!-- Will be populated by JavaScript -->
                </div>
            </nav>
        </div>
    </header>

    <main class="container routes-main">
        <section class="routes-hero">
            <h1>Discover Local Walking Routes</h1>
            <p>Find popular walks near you or share your own adventures</p>
            <button id="locate-me" class="primary-btn">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                    <path d="M8 16s6-5.686 6-10A6 6 0 0 0 2 6c0 4.314 6 10 6 10zm0-7a3 3 0 1 1 0-6 3 3 0 0 1 0 6z"/>
                </svg>
                Find Routes Near Me
            </button>
        </section>

        <div class="location-status" id="location-status"></div>

        <div class="routes-container">
            <div id="map-container" class="map-container">
                <div id="map"></div>
                <div class="map-overlay" id="map-overlay">
                    <div class="spinner"></div>
                    <p>Loading map...</p>
                </div>
            </div>

            <div class="routes-sidebar">
                <div class="routes-filter">
                    <h3>Filter Routes</h3>
                    <div class="filter-options">
                        <label>
                            <span>Distance:</span>
                            <select id="distance-filter">
                                <option value="all">All Distances</option>
                                <option value="short">Short (< 2km)</option>
                                <option value="medium">Medium (2-5km)</option>
                                <option value="long">Long (> 5km)</option>
                            </select>
                        </label>
                        <label>
                            <span>Rating:</span>
                            <select id="rating-filter">
                                <option value="all">All Ratings</option>
                                <option value="4">4+ Stars</option>
                                <option value="3">3+ Stars</option>
                                <option value="2">2+ Stars</option>
                            </select>
                        </label>
                        <label>
                            <span>Difficulty:</span>
                            <select id="difficulty-filter">
                                <option value="all">All Difficulties</option>
                                <option value="easy">Easy</option>
                                <option value="moderate">Moderate</option>
                                <option value="hard">Challenging</option>
                            </select>
                        </label>
                        <label>
                            <span>Show:</span>
                            <select id="route-type-filter">
                                <option value="all">All Routes</option>
                                <option value="user">My Routes</option>
                            </select>
                        </label>
                    </div>
                </div>

                <div class="routes-list" id="routes-list">
                    <div class="routes-loading" id="routes-loading">
                        <div class="spinner"></div>
                        <p>Finding nearby routes...</p>
                    </div>
                    <!-- Routes will be populated here by JavaScript -->
                </div>

                <button id="add-route-btn" class="primary-btn full-width">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                        <path d="M8 0a1 1 0 0 1 1 1v6h6a1 1 0 1 1 0 2H9v6a1 1 0 1 1-2 0V9H1a1 1 0 0 1 0-2h6V1a1 1 0 0 1 1-1z"/>
                    </svg>
                    Add Your Route
                </button>
            </div>
        </div>

        <!-- Route Detail Modal -->
        <div id="route-detail-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 id="modal-route-title">Route Title</h2>
                    <button class="close-modal">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="route-detail-map" id="detail-map"></div>
                    <div class="route-info">
                        <div class="route-stats">
                            <div class="stat">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                                    <path d="M8 16s6-5.686 6-10A6 6 0 0 0 2 6c0 4.314 6 10 6 10zm0-7a3 3 0 1 1 0-6 3 3 0 0 1 0 6z"/>
                                </svg>
                                <span id="route-distance">0 km</span>
                            </div>
                            <div class="stat">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                                    <path d="M8 3.5a.5.5 0 0 0-1 0V9a.5.5 0 0 0 .252.434l3.5 2a.5.5 0 0 0 .496-.868L8 8.71V3.5z"/>
                                    <path d="M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16zm7-8A7 7 0 1 1 1 8a7 7 0 0 1 14 0z"/>
                                </svg>
                                <span id="route-duration">0 min</span>
                            </div>
                            <div class="stat">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                                    <path d="M7.657 6.247c.11-.33.576-.33.686 0l.645 1.937a2.89 2.89 0 0 0 1.829 1.828l1.936.645c.33.11.33.576 0 .686l-1.937.645a2.89 2.89 0 0 0-1.828 1.829l-.645 1.936a.361.361 0 0 1-.686 0l-.645-1.937a2.89 2.89 0 0 0-1.828-1.828l-1.937-.645a.361.361 0 0 1 0-.686l1.937-.645a2.89 2.89 0 0 0 1.828-1.828l.645-1.937zM3.794 1.148a.217.217 0 0 1 .412 0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217 0 0 1 0 .412l-1.162.387A1.734 1.734 0 0 0 4.593 5.69l-.387 1.162a.217.217 0 0 1-.412 0L3.407 5.69A1.734 1.734 0 0 0 2.31 4.593l-1.162-.387a.217.217 0 0 1 0-.412l1.162-.387A1.734 1.734 0 0 0 3.407 2.31l.387-1.162zM10.863.099a.145.145 0 0 1 .274 0l.258.774c.115.346.386.617.732.732l.774.258a.145.145 0 0 1 0 .274l-.774.258a1.156 1.156 0 0 0-.732.732l-.258.774a.145.145 0 0 1-.274 0l-.258-.774a1.156 1.156 0 0 0-.732-.732L9.1 2.137a.145.145 0 0 1 0-.274l.774-.258c.346-.115.617-.386.732-.732L10.863.1z"/>
                                </svg>
                                <span id="route-difficulty">Easy</span>
                            </div>
                        </div>
                        <div class="route-rating" id="route-rating">
                            <!-- Rating stars will be added here -->
                        </div>
                        <p id="route-description"></p>
                        <div class="route-author">
                            <span>Created by:</span>
                            <span id="route-author-name">User Name</span>
                        </div>
                        <div class="route-reviews" id="route-reviews">
                            <h3>Reviews</h3>
                            <div class="reviews-list" id="reviews-list">
                                <!-- Reviews will be populated here -->
                            </div>
                            <div class="add-review">
                                <h4>Add Your Review</h4>
                                <div class="rating-select" id="rating-select">
                                    <span data-rating="1">&#9733;</span>
                                    <span data-rating="2">&#9733;</span>
                                    <span data-rating="3">&#9733;</span>
                                    <span data-rating="4">&#9733;</span>
                                    <span data-rating="5">&#9733;</span>
                                </div>
                                <textarea id="review-text" placeholder="Share your experience..."></textarea>
                                <button id="submit-review" class="primary-btn">Submit Review</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Add Route Modal -->
        <div id="add-route-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>Add New Walking Route</h2>
                    <button class="close-modal">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="add-route-form">
                        <div class="form-group">
                            <label for="route-title">Route Title</label>
                            <input type="text" id="route-title" placeholder="Enter a descriptive title">
                        </div>
                        <div class="form-group">
                            <label for="route-desc">Description</label>
                            <textarea id="route-desc" placeholder="Describe the walking route, points of interest, etc."></textarea>
                        </div>
                        <div class="form-row">
                            <div class="form-group half">
                                <label for="route-difficulty-input">Difficulty</label>
                                <select id="route-difficulty-input">
                                    <option value="easy">Easy</option>
                                    <option value="moderate">Moderate</option>
                                    <option value="hard">Challenging</option>
                                </select>
                            </div>
                            <div class="form-group half">
                                <label for="route-duration-input">Estimated Duration (minutes)</label>
                                <input type="number" id="route-duration-input" min="5" placeholder="Duration in minutes">
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Draw Route on Map</label>
                            <div class="create-route-map" id="create-route-map"></div>
                            <div id="drawing-status" class="drawing-status">
                                Click "Start Drawing" to begin creating your route.
                            </div>
                            <div class="map-controls">
                                <button id="draw-route" class="secondary-btn">Start Drawing</button>
                                <button id="finish-drawing" class="secondary-btn" disabled>Finish Drawing</button>
                                <button id="clear-route" class="secondary-btn">Clear</button>
                            </div>
                            <p class="hint">Click on the map to add points. Use "Finish Drawing" when you're done.</p>
                        </div>
                        <button id="submit-route" class="primary-btn full-width">Submit Route</button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <footer class="app-footer">
        <div class="container">
            <p>&copy; 2025 Travel Companion App</p>
        </div>
    </footer>

    <!-- Scripts -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
    <script src="routes.js"></script>
    <script>
        // User authentication functionality
        
        // DOM Elements
        const authContainer = document.getElementById('auth-container');
        
        // Get user from localStorage
        function getCurrentUser() {
            const userJSON = localStorage.getItem('user');
            if (!userJSON) return null;
            
            try {
                return JSON.parse(userJSON);
            } catch (error) {
                console.error('Error parsing user JSON:', error);
                return null;
            }
        }
        
        // Get access token from localStorage
        function getAccessToken() {
            return localStorage.getItem('access_token');
        }
        
        // Check if user is logged in
        function isLoggedIn() {
            return getAccessToken() && getCurrentUser();
        }
        
        // Render auth container based on login status
        function renderAuthUI() {
            if (isLoggedIn()) {
                const user = getCurrentUser();
                const initials = user.name.split(' ')
                    .map(n => n[0])
                    .join('')
                    .toUpperCase();
                
                authContainer.innerHTML = `
                    <div class="user-menu">
                        <button class="user-menu-btn" id="user-menu-btn">
                            <div class="user-avatar">${initials}</div>
                            <span>${user.name}</span>
                        </button>
                        <div class="user-dropdown" id="user-dropdown">
                            <a href="profile.html" class="user-dropdown-item profile">Profile</a>
                            <a href="preferences.html" class="user-dropdown-item preferences">Preferences</a>
                            <a href="#" class="user-dropdown-item logout">Logout</a>
                        </div>
                    </div>
                `;
                
                // Set up event listeners
                const userMenuBtn = document.getElementById('user-menu-btn');
                const userDropdown = document.getElementById('user-dropdown');
                const logoutLink = document.querySelector('.user-dropdown-item.logout');
                
                userMenuBtn.addEventListener('click', () => {
                    userDropdown.classList.toggle('show');
                });
                
                // Close dropdown when clicking outside
                document.addEventListener('click', (e) => {
                    if (!userMenuBtn.contains(e.target) && !userDropdown.contains(e.target)) {
                        userDropdown.classList.remove('show');
                    }
                });
                
                // Logout functionality
                logoutLink.addEventListener('click', (e) => {
                    e.preventDefault();
                    logout();
                });
            } else {
                authContainer.innerHTML = `
                    <div class="auth-links">
                        <a href="auth.html" class="login">Login</a>
                        <a href="auth.html" class="register">Register</a>
                    </div>
                `;
            }
        }
        
        // Logout function
        function logout() {
            // Clear local storage
            localStorage.removeItem('access_token');
            localStorage.removeItem('refresh_token');
            localStorage.removeItem('user');
            
            // Reload page
            window.location.reload();
        }
        
        // Initialize on page load
        document.addEventListener('DOMContentLoaded', () => {
            renderAuthUI();
            applyStoredLanguagePreference();
        });
        
        // Apply stored language preference
        function applyStoredLanguagePreference() {
            // Get stored preferences
            const storedPrefs = localStorage.getItem('userPreferences');
            if (storedPrefs) {
                try {
                    const prefs = JSON.parse(storedPrefs);
                    if (prefs.language) {
                        document.documentElement.lang = prefs.language;
                        
                        // Comprehensive translations for all supported languages
                        const translationKeys = {
                            'en': {
                                'routesTitle': 'Discover Local Walking Routes',
                                'routesSubtitle': 'Find popular walks near you or share your own adventures',
                                'nearMeBtn': 'Find Routes Near Me',
                                'filterRoutes': 'Filter Routes',
                                'addRouteBtn': 'Add Your Route',
                                'viewDetails': 'View Details',
                                'delete': 'Delete',
                                'distance': 'Distance',
                                'difficulty': 'Difficulty',
                                'duration': 'Duration',
                                'rating': 'Rating',
                                'author': 'Author',
                                'reviews': 'Reviews',
                                'all': 'All',
                                'easy': 'Easy',
                                'moderate': 'Moderate',
                                'hard': 'Hard',
                                'short': 'Short',
                                'medium': 'Medium',
                                'long': 'Long',
                                'closeModal': 'Close',
                                'startDrawing': 'Start Drawing',
                                'finishDrawing': 'Finish Drawing',
                                'clearRoute': 'Clear Route',
                                'submitRoute': 'Submit Route',
                                'routeTitle': 'Route Title',
                                'routeDescription': 'Route Description',
                                'writeReview': 'Write a Review',
                                'submitReview': 'Submit Review',
                                'loading': 'Loading...',
                                'noRoutes': 'No routes found. Try adjusting your filters or creating a new route.',
                                'confirmDelete': 'Are you sure you want to delete this route?'
                            },
                            'es': {
                                'routesTitle': 'Descubre Rutas de Caminata Locales',
                                'routesSubtitle': 'Encuentra caminatas populares cerca de ti o comparte tus propias aventuras',
                                'nearMeBtn': 'Encontrar Rutas Cercanas',
                                'filterRoutes': 'Filtrar Rutas',
                                'addRouteBtn': 'Agregar Tu Ruta',
                                'viewDetails': 'Ver Detalles',
                                'delete': 'Eliminar',
                                'distance': 'Distancia',
                                'difficulty': 'Dificultad',
                                'duration': 'Duración',
                                'rating': 'Calificación',
                                'author': 'Autor',
                                'reviews': 'Reseñas',
                                'all': 'Todas',
                                'easy': 'Fácil',
                                'moderate': 'Moderada',
                                'hard': 'Difícil',
                                'short': 'Corta',
                                'medium': 'Media',
                                'long': 'Larga',
                                'closeModal': 'Cerrar',
                                'startDrawing': 'Comenzar a Dibujar',
                                'finishDrawing': 'Finalizar Dibujo',
                                'clearRoute': 'Borrar Ruta',
                                'submitRoute': 'Enviar Ruta',
                                'routeTitle': 'Título de la Ruta',
                                'routeDescription': 'Descripción de la Ruta',
                                'writeReview': 'Escribir una Reseña',
                                'submitReview': 'Enviar Reseña',
                                'loading': 'Cargando...',
                                'noRoutes': 'No se encontraron rutas. Intenta ajustar tus filtros o crear una nueva ruta.',
                                'confirmDelete': '¿Estás seguro de que quieres eliminar esta ruta?'
                            },
                            'fr': {
                                'routesTitle': 'Découvrez des Itinéraires de Marche Locaux',
                                'routesSubtitle': 'Trouvez des promenades populaires près de chez vous ou partagez vos propres aventures',
                                'nearMeBtn': 'Trouver des Itinéraires à Proximité',
                                'filterRoutes': 'Filtrer les Itinéraires',
                                'addRouteBtn': 'Ajouter Votre Itinéraire',
                                'viewDetails': 'Voir les Détails',
                                'delete': 'Supprimer',
                                'distance': 'Distance',
                                'difficulty': 'Difficulté',
                                'duration': 'Durée',
                                'rating': 'Évaluation',
                                'author': 'Auteur',
                                'reviews': 'Avis',
                                'all': 'Tous',
                                'easy': 'Facile',
                                'moderate': 'Modérée',
                                'hard': 'Difficile',
                                'short': 'Courte',
                                'medium': 'Moyenne',
                                'long': 'Longue',
                                'closeModal': 'Fermer',
                                'startDrawing': 'Commencer à Dessiner',
                                'finishDrawing': 'Terminer le Dessin',
                                'clearRoute': 'Effacer l\'Itinéraire',
                                'submitRoute': 'Soumettre l\'Itinéraire',
                                'routeTitle': 'Titre de l\'Itinéraire',
                                'routeDescription': 'Description de l\'Itinéraire',
                                'writeReview': 'Écrire un Avis',
                                'submitReview': 'Soumettre l\'Avis',
                                'loading': 'Chargement...',
                                'noRoutes': 'Aucun itinéraire trouvé. Essayez d\'ajuster vos filtres ou de créer un nouvel itinéraire.',
                                'confirmDelete': 'Êtes-vous sûr de vouloir supprimer cet itinéraire?'
                            },
                            'de': {
                                'routesTitle': 'Entdecken Sie lokale Wanderrouten',
                                'routesSubtitle': 'Finden Sie beliebte Spaziergänge in Ihrer Nähe oder teilen Sie Ihre eigenen Abenteuer',
                                'nearMeBtn': 'Routen in meiner Nähe finden',
                                'filterRoutes': 'Routen filtern',
                                'addRouteBtn': 'Ihre Route hinzufügen',
                                'viewDetails': 'Details anzeigen',
                                'delete': 'Löschen',
                                'distance': 'Entfernung',
                                'difficulty': 'Schwierigkeit',
                                'duration': 'Dauer',
                                'rating': 'Bewertung',
                                'author': 'Autor',
                                'reviews': 'Bewertungen',
                                'all': 'Alle',
                                'easy': 'Leicht',
                                'moderate': 'Mittel',
                                'hard': 'Schwer',
                                'short': 'Kurz',
                                'medium': 'Mittel',
                                'long': 'Lang',
                                'closeModal': 'Schließen',
                                'startDrawing': 'Zeichnen beginnen',
                                'finishDrawing': 'Zeichnen beenden',
                                'clearRoute': 'Route löschen',
                                'submitRoute': 'Route einreichen',
                                'routeTitle': 'Routentitel',
                                'routeDescription': 'Routenbeschreibung',
                                'writeReview': 'Bewertung schreiben',
                                'submitReview': 'Bewertung abschicken',
                                'loading': 'Wird geladen...',
                                'noRoutes': 'Keine Routen gefunden. Versuchen Sie, Ihre Filter anzupassen oder eine neue Route zu erstellen.',
                                'confirmDelete': 'Sind Sie sicher, dass Sie diese Route löschen möchten?'
                            },
                            'it': {
                                'routesTitle': 'Scopri Percorsi di Passeggiata Locali',
                                'routesSubtitle': 'Trova passeggiate popolari vicino a te o condividi le tue avventure',
                                'nearMeBtn': 'Trova Percorsi Vicini',
                                'filterRoutes': 'Filtra Percorsi',
                                'addRouteBtn': 'Aggiungi il Tuo Percorso',
                                'viewDetails': 'Vedi Dettagli',
                                'delete': 'Elimina',
                                'distance': 'Distanza',
                                'difficulty': 'Difficoltà',
                                'duration': 'Durata',
                                'rating': 'Valutazione',
                                'author': 'Autore',
                                'reviews': 'Recensioni',
                                'all': 'Tutti',
                                'easy': 'Facile',
                                'moderate': 'Moderata',
                                'hard': 'Difficile',
                                'short': 'Breve',
                                'medium': 'Media',
                                'long': 'Lunga',
                                'closeModal': 'Chiudi',
                                'startDrawing': 'Inizia a Disegnare',
                                'finishDrawing': 'Termina Disegno',
                                'clearRoute': 'Cancella Percorso',
                                'submitRoute': 'Invia Percorso',
                                'routeTitle': 'Titolo del Percorso',
                                'routeDescription': 'Descrizione del Percorso',
                                'writeReview': 'Scrivi una Recensione',
                                'submitReview': 'Invia Recensione',
                                'loading': 'Caricamento...',
                                'noRoutes': 'Nessun percorso trovato. Prova a modificare i filtri o a creare un nuovo percorso.',
                                'confirmDelete': 'Sei sicuro di voler eliminare questo percorso?'
                            },
                            'pt': {
                                'routesTitle': 'Descubra Rotas de Caminhada Locais',
                                'routesSubtitle': 'Encontre caminhadas populares perto de você ou compartilhe suas próprias aventuras',
                                'nearMeBtn': 'Encontrar Rotas Próximas',
                                'filterRoutes': 'Filtrar Rotas',
                                'addRouteBtn': 'Adicionar Sua Rota',
                                'viewDetails': 'Ver Detalhes',
                                'delete': 'Excluir',
                                'distance': 'Distância',
                                'difficulty': 'Dificuldade',
                                'duration': 'Duração',
                                'rating': 'Avaliação',
                                'author': 'Autor',
                                'reviews': 'Avaliações',
                                'all': 'Todas',
                                'easy': 'Fácil',
                                'moderate': 'Moderada',
                                'hard': 'Difícil',
                                'short': 'Curta',
                                'medium': 'Média',
                                'long': 'Longa',
                                'closeModal': 'Fechar',
                                'startDrawing': 'Começar a Desenhar',
                                'finishDrawing': 'Finalizar Desenho',
                                'clearRoute': 'Limpar Rota',
                                'submitRoute': 'Enviar Rota',
                                'routeTitle': 'Título da Rota',
                                'routeDescription': 'Descrição da Rota',
                                'writeReview': 'Escrever uma Avaliação',
                                'submitReview': 'Enviar Avaliação',
                                'loading': 'Carregando...',
                                'noRoutes': 'Nenhuma rota encontrada. Tente ajustar seus filtros ou criar uma nova rota.',
                                'confirmDelete': 'Tem certeza que deseja excluir esta rota?'
                            },
                            'ja': {
                                'routesTitle': '地元のウォーキングルートを発見',
                                'routesSubtitle': '人気のウォーキングコースを見つけたり、自分の冒険を共有しましょう',
                                'nearMeBtn': '近くのルートを探す',
                                'filterRoutes': 'ルートをフィルタリング',
                                'addRouteBtn': 'ルートを追加',
                                'viewDetails': '詳細を見る',
                                'delete': '削除',
                                'distance': '距離',
                                'difficulty': '難易度',
                                'duration': '時間',
                                'rating': '評価',
                                'author': '作成者',
                                'reviews': 'レビュー',
                                'all': 'すべて',
                                'easy': '簡単',
                                'moderate': '普通',
                                'hard': '難しい',
                                'short': '短い',
                                'medium': '中程度',
                                'long': '長い',
                                'closeModal': '閉じる',
                                'startDrawing': '描画開始',
                                'finishDrawing': '描画完了',
                                'clearRoute': 'ルートをクリア',
                                'submitRoute': 'ルートを送信',
                                'routeTitle': 'ルートのタイトル',
                                'routeDescription': 'ルートの説明',
                                'writeReview': 'レビューを書く',
                                'submitReview': 'レビューを送信',
                                'loading': '読み込み中...',
                                'noRoutes': 'ルートが見つかりません。フィルターを調整するか、新しいルートを作成してみてください。',
                                'confirmDelete': 'このルートを削除してもよろしいですか？'
                            },
                            'zh': {
                                'routesTitle': '发现当地步行路线',
                                'routesSubtitle': '找到您附近的热门步行路线或分享您自己的冒险',
                                'nearMeBtn': '查找附近的路线',
                                'filterRoutes': '筛选路线',
                                'addRouteBtn': '添加您的路线',
                                'viewDetails': '查看详情',
                                'delete': '删除',
                                'distance': '距离',
                                'difficulty': '难度',
                                'duration': '时长',
                                'rating': '评分',
                                'author': '作者',
                                'reviews': '评论',
                                'all': '全部',
                                'easy': '简单',
                                'moderate': '中等',
                                'hard': '困难',
                                'short': '短程',
                                'medium': '中程',
                                'long': '长程',
                                'closeModal': '关闭',
                                'startDrawing': '开始绘制',
                                'finishDrawing': '完成绘制',
                                'clearRoute': '清除路线',
                                'submitRoute': '提交路线',
                                'routeTitle': '路线标题',
                                'routeDescription': '路线描述',
                                'writeReview': '写评论',
                                'submitReview': '提交评论',
                                'loading': '加载中...',
                                'noRoutes': '未找到路线。尝试调整筛选条件或创建新路线。',
                                'confirmDelete': '您确定要删除此路线吗？'
                            },
                            'ko': {
                                'routesTitle': '주변 경로 탐색',
                                'routesSubtitle': '주변의 인기 있는 산책로를 찾거나 직접 경험을 공유하세요',
                                'nearMeBtn': '내 주변 경로 찾기',
                                'filterRoutes': '경로 필터링',
                                'addRouteBtn': '내 경로 추가',
                                'viewDetails': '상세 보기',
                                'delete': '삭제',
                                'distance': '거리',
                                'difficulty': '난이도',
                                'duration': '소요 시간',
                                'rating': '평점',
                                'author': '작성자',
                                'reviews': '리뷰',
                                'all': '전체',
                                'easy': '쉬움',
                                'moderate': '보통',
                                'hard': '어려움',
                                'short': '짧은 거리',
                                'medium': '중간 거리',
                                'long': '긴 거리',
                                'closeModal': '닫기',
                                'startDrawing': '그리기 시작',
                                'finishDrawing': '그리기 완료',
                                'clearRoute': '경로 지우기',
                                'submitRoute': '경로 제출',
                                'routeTitle': '경로 제목',
                                'routeDescription': '경로 설명',
                                'writeReview': '리뷰 작성',
                                'submitReview': '리뷰 제출',
                                'loading': '로딩 중...',
                                'noRoutes': '경로를 찾을 수 없습니다. 필터를 조정하거나 새 경로를 생성해 보세요.',
                                'confirmDelete': '이 경로를 삭제하시겠습니까?'
                            }
                        };
                        
                        // Get translations for selected language or fallback to English
                        const translations = translationKeys[prefs.language] || translationKeys['en'];
                        
                        try {
                            // Safely update text content with error handling
                            const safeUpdateText = (selector, text) => {
                                const element = document.querySelector(selector);
                                if (element) {
                                    element.textContent = text;
                                } else {
                                    console.warn(`Element not found: ${selector}`);
                                }
                            };
                            
                            const safeUpdateHTML = (selector, html) => {
                                const element = document.querySelector(selector);
                                if (element) {
                                    element.innerHTML = html;
                                } else {
                                    console.warn(`Element not found: ${selector}`);
                                }
                            };
                            
                            // Update text content based on language
                            safeUpdateText('.routes-hero h1', translations.routesTitle);
                            safeUpdateText('.routes-hero p', translations.routesSubtitle);
                            safeUpdateText('.routes-filter h3', translations.filterRoutes);
                            
                            // Update HTML content
                            safeUpdateHTML('#locate-me', `
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                                    <path d="M8 16s6-5.686 6-10A6 6 0 0 0 2 6c0 4.314 6 10 6 10zm0-7a3 3 0 1 1 0-6 3 3 0 0 1 0 6z"/>
                                </svg>
                                ${translations.nearMeBtn}
                            `);
                            
                            safeUpdateHTML('#add-route-btn', `
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                                    <path d="M8 0a1 1 0 0 1 1 1v6h6a1 1 0 1 1 0 2H9v6a1 1 0 1 1-2 0V9H1a1 1 0 0 1 0-2h6V1a1 1 0 0 1 1-1z"/>
                                </svg>
                                ${translations.addRouteBtn}
                            `);
                        } catch (updateError) {
                            console.error('Error updating language elements:', updateError);
                        }
                    }
                } catch (e) {
                    console.error('Error parsing stored preferences:', e);
                }
            }
        }
    </script>
</body>
</html> 